"use strict";!function(e){function t(a){if(n[a])return n[a].exports;var i=n[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=3)}([function(e,t){!function(e){var t=function(t){return null!=t||t!=e},n=function(e,t){for(var n=i._callbacks[e],a=0;a<n.length;a++)n[a].apply(window,t)},a=function(e){for(var t=0,n=e.length-1;n>e.length-6;n--)t+=e[n];return t/5},i=window.Compass={method:e,watch:function(e){var t=++i._lastId;return i.init(function(n){if("phonegap"==n)i._watchers[t]=i._nav.compass.watchHeading(e);else if("webkitOrientation"==n){var a=function(t){e(t.webkitCompassHeading)};i._win.addEventListener("deviceorientation",a),i._watchers[t]=a}else if("orientationAndGPS"==n){var o,a=function(t){o=-t.alpha+i._gpsDiff,o<0?o+=360:o>360&&(o-=360),e(o)};i._win.addEventListener("deviceorientation",a),i._watchers[t]=a}}),t},unwatch:function(e){return i.init(function(t){"phonegap"==t?i._nav.compass.clearWatch(i._watchers[e]):("webkitOrientation"==t||"orientationAndGPS"==t)&&i._win.removeEventListener("deviceorientation",i._watchers[e]),delete i._watchers[e]}),i},needGPS:function(e){return i._callbacks.needGPS.push(e),i},needMove:function(e){return i._callbacks.needMove.push(e),i},noSupport:function(e){return!1===i.method?e():t(i.method)||i._callbacks.noSupport.push(e),i},init:function(e){return t(i.method)?void e(i.method):(i._callbacks.init.push(e),i._initing?void 0:(i._initing=!0,i._nav.compass?i._start("phonegap"):i._win.DeviceOrientationEvent?(i._checking=0,i._win.addEventListener("deviceorientation",i._checkEvent),setTimeout(function(){!1!==i._checking&&i._start(!1)},500)):i._start(!1),i))},_lastId:0,_watchers:{},_win:window,_nav:navigator,_callbacks:{init:[],noSupport:[],needGPS:[],needMove:[]},_initing:!1,_gpsDiff:e,_start:function(e){i.method=e,i._initing=!1,n("init",[e]),i._callbacks.init=[],!1===e&&n("noSupport",[]),i._callbacks.noSupport=[]},_checking:!1,_checkEvent:function(e){i._checking+=1;var n=!1;t(e.webkitCompassHeading)?i._start("webkitOrientation"):t(e.alpha)&&i._nav.geolocation?i._gpsHack():i._checking>1?i._start(!1):n=!0,n||(i._checking=!1,i._win.removeEventListener("deviceorientation",i._checkEvent))},_gpsHack:function(){var e=!0,o=[],r=[];n("needGPS");var c=function(e){o.push(e.alpha)};i._win.addEventListener("deviceorientation",c);var s=function(s){var l=s.coords;t(l.heading)&&(e&&(e=!1,n("needMove")),l.speed>1?(r.push(l.heading),r.length>=5&&o.length>=5&&(i._win.removeEventListener("deviceorientation",c),i._nav.geolocation.clearWatch(d),i._gpsDiff=a(r)+a(o),i._start("orientationAndGPS"))):r=[])},l=function(){i._win.removeEventListener("deviceorientation",c),i._start(!1)},d=i._nav.geolocation.watchPosition(s,l,{enableHighAccuracy:!0})}}}()},function(e,t){},function(e,t){},function(e,t,n){function a(e){if(!(Math.floor(e)>=p-2&&Math.floor(e)<=p+2)){p=e;var t=c(e),n=-Math.sin(t),a=Math.cos(t);d.setListenerOrientation(n,a,0,0,0,1)}}function i(){for(var e=0;e<k.length;e++){var t=geolib.getBearing({latitude:v,longitude:m},{latitude:k[e].lat,longitude:k[e].long}),n=geolib.getDistance({latitude:v,longitude:m},{latitude:k[e].lat,longitude:k[e].long})*M,a=Math.sin(c(t))*S,i=-Math.cos(c(t))*S;h[e].setPosition(a,i,0),h[e].setGain(200/(n*n)),console.log(k[e].name),console.log(t+":"+s(t)),console.log(a,i)}}function o(){l=new(window.AudioContext||window.webkitAudioContext),d=new ResonanceAudio(l,{ambisonicOrder:1}),d.setRoomProperties(P,I.outside),d.output.connect(l.destination)}function r(){k=f.filter(function(e){return-1!=w[g].indexOf(e.id)}),y=f.filter(function(e){return-1!=b[g].indexOf(e.id)}),document.getElementById("hints").innerHTML="<span>Tap a location to hear it</span>";for(var e=0;e<k.length;e++)!function(e){var t=document.createElement("button");t.innerHTML=k[e].name,t.classList.add("hint"),t.onclick=function(t){u[e].paused?(t.target.classList.add("active"),u[e].play()):(t.target.classList.remove("active"),u[e].pause())},document.getElementById("hints").append(t)}(e);document.getElementById("options").innerHTML="<span>Guess where you are:</span>";for(var e=0;e<y.length;e++)!function(e){var t=document.createElement("button");t.innerHTML=y[e].name,t.classList.add("option"),t.onclick=function(t){y[e].id==_[g]?(alert("Correct!"),g<_.length-1?(g++,r()):alert("Game Over")):alert("Wrong!")},document.getElementById("options").append(t)}(e);for(var t=[],e=0;e<k.length;e++)u[e]=document.createElement("audio"),u[e].src=k[e].src,u[e].load(),u[e].loop=!0,u[e].crossOrigin="anonymous",t[e]=l.createMediaElementSource(u[e]),h[e]=d.createSource(),t[e].connect(h[e].input);i()}function c(e){return e*(Math.PI/180)}function s(e){return e>=337.5||e<22.5?"N":e>=22.5&&e<67.5?"NE":e>=67.5&&e<112.5?"E":e>=112.5&&e<157.5?"SE":e>=157.5&&e<202.5?"S":e>=202.5&&e<247.5?"SW":e>=247.5&&e<292.5?"W":e>=292.5&&e<337.5?"NW":"error"}n(1),n(2),n(0);var l=void 0,d=void 0,u=[],h=[],p=0,v=31.771947,m=35.204153,f=[{name:"Jaffa Gate / Old City",id:"oldcity",lat:31.776598,long:35.227609,src:"./assets/bells.wav"},{name:"The Knesset",id:"knesset",lat:31.77663,long:35.205471,src:"./assets/drums.wav"},{name:"Mahane Yehuda Market",id:"market",lat:31.784851,long:35.212643,src:"./assets/market.wav"},{name:"Yad Vashem / Mt. Herzl",id:"herzl",lat:31.774192,long:35.176195,src:"./assets/violin.wav"},{name:"Teddy Stadium",id:"teddy",lat:31.750973,long:35.190621,src:"./assets/crowd.wav"},{name:"Ammunition Hill",id:"hill",lat:31.798014,long:35.227671,src:"./assets/trumpet.wav"},{name:"The Israel Museum",id:"museum",lat:31.771947,long:35.204153,src:"./assets/piano.wav"},,{name:"Mount Scopus",id:"scopus",lat:31.795354,long:35.242609,src:"./assets/guitar.wav"}],g=0,_=["museum","scopus","herzl"],w=[["knesset","herzl","market"],["oldcity","teddy","hill"],["scopus","museum","teddy"]],b=[["oldcity","teddy","museum"],["knesset","herzl","scopus"],["herzl","teddy","oldcity"]],k=void 0,y=void 0,E=!1,L=!1,M=.02,S=1,H=function(){o(),r(),Compass.watch(function(e){document.getElementById("heading").innerHTML=s(e),a(e)}),document.getElementById("play").addEventListener("click",function(e){l.resume(),L?E?(u.forEach(function(e){e.pause()}),E=!1,e.target.innerHTML="Play All"):(u.forEach(function(e){e.play()}),E=!0,e.target.innerHTML="Pause All"):(e.target.innerHTML="Play All",document.getElementById("hints").classList.remove("hidden"),document.getElementById("options").classList.remove("hidden"),L=!0),document.getElementById("play").addEventListener("touchstart",function(e){e.target.classList.add("active")}),document.getElementById("play").addEventListener("touchend",function(e){e.target.classList.remove("active")})})};window.addEventListener("load",H);var P={width:2,height:2,depth:2},I={brick:{left:"brick-bare",right:"brick-bare",up:"brick-bare",down:"wood-panel",front:"brick-bare",back:"brick-bare"},curtains:{left:"curtain-heavy",right:"curtain-heavy",up:"wood-panel",down:"wood-panel",front:"curtain-heavy",back:"curtain-heavy"},marble:{left:"marble",right:"marble",up:"marble",down:"marble",front:"marble",back:"marble"},outside:{left:"transparent",right:"transparent",up:"transparent",down:"grass",front:"transparent",back:"transparent"}}}]);