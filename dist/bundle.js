"use strict";!function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=3)}([function(e,t){!function(e){var t=function(t){return null!=t||t!=e},n=function(e,t){for(var n=a._callbacks[e],i=0;i<n.length;i++)n[i].apply(window,t)},i=function(e){for(var t=0,n=e.length-1;n>e.length-6;n--)t+=e[n];return t/5},a=window.Compass={method:e,watch:function(e){var t=++a._lastId;return a.init(function(n){if("phonegap"==n)a._watchers[t]=a._nav.compass.watchHeading(e);else if("webkitOrientation"==n){var i=function(t){e(t.webkitCompassHeading)};a._win.addEventListener("deviceorientation",i),a._watchers[t]=i}else if("orientationAndGPS"==n){var o,i=function(t){o=-t.alpha+a._gpsDiff,o<0?o+=360:o>360&&(o-=360),e(o)};a._win.addEventListener("deviceorientation",i),a._watchers[t]=i}}),t},unwatch:function(e){return a.init(function(t){"phonegap"==t?a._nav.compass.clearWatch(a._watchers[e]):("webkitOrientation"==t||"orientationAndGPS"==t)&&a._win.removeEventListener("deviceorientation",a._watchers[e]),delete a._watchers[e]}),a},needGPS:function(e){return a._callbacks.needGPS.push(e),a},needMove:function(e){return a._callbacks.needMove.push(e),a},noSupport:function(e){return!1===a.method?e():t(a.method)||a._callbacks.noSupport.push(e),a},init:function(e){return t(a.method)?void e(a.method):(a._callbacks.init.push(e),a._initing?void 0:(a._initing=!0,a._nav.compass?a._start("phonegap"):a._win.DeviceOrientationEvent?(a._checking=0,a._win.addEventListener("deviceorientation",a._checkEvent),setTimeout(function(){!1!==a._checking&&a._start(!1)},500)):a._start(!1),a))},_lastId:0,_watchers:{},_win:window,_nav:navigator,_callbacks:{init:[],noSupport:[],needGPS:[],needMove:[]},_initing:!1,_gpsDiff:e,_start:function(e){a.method=e,a._initing=!1,n("init",[e]),a._callbacks.init=[],!1===e&&n("noSupport",[]),a._callbacks.noSupport=[]},_checking:!1,_checkEvent:function(e){a._checking+=1;var n=!1;t(e.webkitCompassHeading)?a._start("webkitOrientation"):t(e.alpha)&&a._nav.geolocation?a._gpsHack():a._checking>1?a._start(!1):n=!0,n||(a._checking=!1,a._win.removeEventListener("deviceorientation",a._checkEvent))},_gpsHack:function(){var e=!0,o=[],r=[];n("needGPS");var c=function(e){o.push(e.alpha)};a._win.addEventListener("deviceorientation",c);var s=function(s){var d=s.coords;t(d.heading)&&(e&&(e=!1,n("needMove")),d.speed>1?(r.push(d.heading),r.length>=5&&o.length>=5&&(a._win.removeEventListener("deviceorientation",c),a._nav.geolocation.clearWatch(l),a._gpsDiff=i(r)+i(o),a._start("orientationAndGPS"))):r=[])},d=function(){a._win.removeEventListener("deviceorientation",c),a._start(!1)},l=a._nav.geolocation.watchPosition(s,d,{enableHighAccuracy:!0})}}}()},function(e,t){},function(e,t){},function(e,t,n){function i(e){if(!(Math.floor(e)>=m-2&&Math.floor(e)<=m+2)){m=e;var t=c(e),n=-Math.sin(t),i=Math.cos(t);l.setListenerOrientation(n,i,0,0,0,1)}}function a(){for(var e=0;e<k.length;e++){var t=geolib.getBearing({latitude:p,longitude:g},{latitude:k[e].lat,longitude:k[e].long}),n=geolib.getDistance({latitude:p,longitude:g},{latitude:k[e].lat,longitude:k[e].long})*L,i=Math.sin(c(t))*M,a=-Math.cos(c(t))*M;h[e].setPosition(i,a,0),h[e].setGain(200/(n*n)),console.log(k[e].name),console.log(t+":"+s(t)),console.log(i,a)}}function o(){d=new(window.AudioContext||window.webkitAudioContext),l=new ResonanceAudio(d,{ambisonicOrder:1}),l.setRoomProperties(H,I.outside),l.output.connect(d.destination)}function r(){k=v.filter(function(e){return-1!=w[f].indexOf(e.id)}),y=v.filter(function(e){return-1!=b[f].indexOf(e.id)}),document.getElementById("hints").innerHTML="<span>Tap a location to hear it</span>";for(var e=0;e<k.length;e++)!function(e){var t=document.createElement("button");t.innerHTML=k[e].name,t.classList.add("hint"),t.onclick=function(t){u[e].paused?(t.target.classList.add("active"),u[e].play()):(t.target.classList.remove("active"),u[e].pause())},document.getElementById("hints").append(t)}(e);document.getElementById("options").innerHTML="<span>Guess where you are:</span>";for(var e=0;e<y.length;e++)!function(e){var t=document.createElement("button");t.innerHTML=y[e].name,t.classList.add("option"),t.onclick=function(t){y[e].id==_[f]?(alert("Correct!"),u.forEach(function(e){e.pause()}),f<_.length-1?(f++,r()):document.getElementById("body").innerHTML='<img src="./assets/logo.png" id="logo"><h1>You Won!</h1>'):alert("Wrong!")},document.getElementById("options").append(t)}(e);for(var t=[],e=0;e<k.length;e++)u[e]=document.createElement("audio"),u[e].src=k[e].src,u[e].load(),u[e].loop=!0,u[e].crossOrigin="anonymous",t[e]=d.createMediaElementSource(u[e]),h[e]=l.createSource(),t[e].connect(h[e].input);a()}function c(e){return e*(Math.PI/180)}function s(e){return e>=337.5||e<22.5?"N":e>=22.5&&e<67.5?"NE":e>=67.5&&e<112.5?"E":e>=112.5&&e<157.5?"SE":e>=157.5&&e<202.5?"S":e>=202.5&&e<247.5?"SW":e>=247.5&&e<292.5?"W":e>=292.5&&e<337.5?"NW":"error"}n(1),n(2),n(0);var d=void 0,l=void 0,u=[],h=[],m=0,p=31.771947,g=35.204153,v=[{name:"Jaffa Gate / Old City",id:"oldcity",lat:31.776598,long:35.227609,src:"./assets/bells.wav"},{name:"The Knesset",id:"knesset",lat:31.77663,long:35.205471,src:"./assets/drums.wav"},{name:"Mahane Yehuda Market",id:"market",lat:31.784851,long:35.212643,src:"./assets/market.wav"},{name:"Yad Vashem / Mt. Herzl",id:"herzl",lat:31.774192,long:35.176195,src:"./assets/violin.wav"},{name:"Teddy Stadium",id:"teddy",lat:31.750973,long:35.190621,src:"./assets/crowd.wav"},{name:"Ammunition Hill",id:"hill",lat:31.798014,long:35.227671,src:"./assets/trumpet.wav"},{name:"The Israel Museum",id:"museum",lat:31.771947,long:35.204153,src:"./assets/piano.wav"},,{name:"Mount Scopus",id:"scopus",lat:31.795354,long:35.242609,src:"./assets/guitar.wav"}],f=0,_=["museum","scopus","herzl"],w=[["knesset","herzl","market"],["oldcity","teddy","hill"],["scopus","museum","teddy"]],b=[["oldcity","teddy","museum"],["knesset","herzl","scopus"],["herzl","teddy","oldcity"]],k=void 0,y=void 0,E=!1,L=.02,M=1,S=function(){o(),r(),Compass.watch(function(e){document.getElementById("heading").innerHTML=s(e),i(e)}),document.getElementById("play").addEventListener("click",function(e){d.resume(),E||(e.target.innerHTML="Play All",document.getElementById("hints").classList.remove("hidden"),document.getElementById("options").classList.remove("hidden"),E=!0,e.target.remove()),document.getElementById("play").addEventListener("touchstart",function(e){e.target.classList.add("active")}),document.getElementById("play").addEventListener("touchend",function(e){e.target.classList.remove("active")})})};window.addEventListener("load",S);var H={width:2,height:2,depth:2},I={brick:{left:"brick-bare",right:"brick-bare",up:"brick-bare",down:"wood-panel",front:"brick-bare",back:"brick-bare"},curtains:{left:"curtain-heavy",right:"curtain-heavy",up:"wood-panel",down:"wood-panel",front:"curtain-heavy",back:"curtain-heavy"},marble:{left:"marble",right:"marble",up:"marble",down:"marble",front:"marble",back:"marble"},outside:{left:"transparent",right:"transparent",up:"transparent",down:"grass",front:"transparent",back:"transparent"}}}]);