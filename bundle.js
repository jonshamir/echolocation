"use strict";!function(e){function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}var t={};n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="/",n(n.s=3)}([function(e,n){!function(e){var n=function(n){return null!=n||n!=e},t=function(e,n){for(var t=a._callbacks[e],i=0;i<t.length;i++)t[i].apply(window,n)},i=function(e){for(var n=0,t=e.length-1;t>e.length-6;t--)n+=e[t];return n/5},a=window.Compass={method:e,watch:function(e){var n=++a._lastId;return a.init(function(t){if("phonegap"==t)a._watchers[n]=a._nav.compass.watchHeading(e);else if("webkitOrientation"==t){var i=function(n){e(n.webkitCompassHeading)};a._win.addEventListener("deviceorientation",i),a._watchers[n]=i}else if("orientationAndGPS"==t){var o,i=function(n){o=-n.alpha+a._gpsDiff,o<0?o+=360:o>360&&(o-=360),e(o)};a._win.addEventListener("deviceorientation",i),a._watchers[n]=i}}),n},unwatch:function(e){return a.init(function(n){"phonegap"==n?a._nav.compass.clearWatch(a._watchers[e]):("webkitOrientation"==n||"orientationAndGPS"==n)&&a._win.removeEventListener("deviceorientation",a._watchers[e]),delete a._watchers[e]}),a},needGPS:function(e){return a._callbacks.needGPS.push(e),a},needMove:function(e){return a._callbacks.needMove.push(e),a},noSupport:function(e){return!1===a.method?e():n(a.method)||a._callbacks.noSupport.push(e),a},init:function(e){return n(a.method)?void e(a.method):(a._callbacks.init.push(e),a._initing?void 0:(a._initing=!0,a._nav.compass?a._start("phonegap"):a._win.DeviceOrientationEvent?(a._checking=0,a._win.addEventListener("deviceorientation",a._checkEvent),setTimeout(function(){!1!==a._checking&&a._start(!1)},500)):a._start(!1),a))},_lastId:0,_watchers:{},_win:window,_nav:navigator,_callbacks:{init:[],noSupport:[],needGPS:[],needMove:[]},_initing:!1,_gpsDiff:e,_start:function(e){a.method=e,a._initing=!1,t("init",[e]),a._callbacks.init=[],!1===e&&t("noSupport",[]),a._callbacks.noSupport=[]},_checking:!1,_checkEvent:function(e){a._checking+=1;var t=!1;n(e.webkitCompassHeading)?a._start("webkitOrientation"):n(e.alpha)&&a._nav.geolocation?a._gpsHack():a._checking>1?a._start(!1):t=!0,t||(a._checking=!1,a._win.removeEventListener("deviceorientation",a._checkEvent))},_gpsHack:function(){var e=!0,o=[],r=[];t("needGPS");var c=function(e){o.push(e.alpha)};a._win.addEventListener("deviceorientation",c);var s=function(s){var d=s.coords;n(d.heading)&&(e&&(e=!1,t("needMove")),d.speed>1?(r.push(d.heading),r.length>=5&&o.length>=5&&(a._win.removeEventListener("deviceorientation",c),a._nav.geolocation.clearWatch(l),a._gpsDiff=i(r)+i(o),a._start("orientationAndGPS"))):r=[])},d=function(){a._win.removeEventListener("deviceorientation",c),a._start(!1)},l=a._nav.geolocation.watchPosition(s,d,{enableHighAccuracy:!0})}}}()},function(e,n){},function(e,n){},function(e,n,t){function i(e){if(!(Math.floor(e)>=p-2&&Math.floor(e)<=p+2)){p=e;var n=c(e),t=-Math.sin(n),i=Math.cos(n);l.setListenerOrientation(t,i,0,0,0,1)}}function a(){for(var e=0;e<k.length;e++){var n=geolib.getBearing({latitude:g,longitude:m},{latitude:k[e].lat,longitude:k[e].long}),t=geolib.getDistance({latitude:g,longitude:m},{latitude:k[e].lat,longitude:k[e].long})*M,i=Math.sin(c(n))*S,a=-Math.cos(c(n))*S;h[e].setPosition(i,a,0),h[e].setGain(200/(t*t)),console.log(k[e].name),console.log(n+":"+s(n)),console.log(i,a)}}function o(){d=new(window.AudioContext||window.webkitAudioContext),l=new ResonanceAudio(d,{ambisonicOrder:1}),l.setRoomProperties(P,I.outside),l.output.connect(d.destination)}function r(){k=v.filter(function(e){return-1!=w[f].indexOf(e.id)}),y=v.filter(function(e){return-1!=b[f].indexOf(e.id)}),document.getElementById("hints").innerHTML="<span>Tap a location to hear it</span>";for(var e=0;e<k.length;e++)!function(e){var n=document.createElement("button");n.innerHTML=k[e].name,n.classList.add("hint"),n.onclick=function(n){u[e].paused?(n.target.classList.add("active"),u[e].play()):(n.target.classList.remove("active"),u[e].pause())},document.getElementById("hints").append(n)}(e);document.getElementById("options").innerHTML="<span>Guess where you are:</span>";for(var e=0;e<y.length;e++)!function(e){var n=document.createElement("button");n.innerHTML=y[e].name,n.classList.add("option"),n.onclick=function(n){y[e].id==_[f]?(alert("Correct!"),f<_.length-1?(f++,r()):document.getElementById("body").innerHTML='<img src="./assets/logo.png" id="logo"><h1>You Won!</h1>'):alert("Wrong!")},document.getElementById("options").append(n)}(e);for(var n=[],e=0;e<k.length;e++)u[e]=document.createElement("audio"),u[e].src=k[e].src,u[e].load(),u[e].loop=!0,u[e].crossOrigin="anonymous",n[e]=d.createMediaElementSource(u[e]),h[e]=l.createSource(),n[e].connect(h[e].input);a()}function c(e){return e*(Math.PI/180)}function s(e){return e>=337.5||e<22.5?"N":e>=22.5&&e<67.5?"NE":e>=67.5&&e<112.5?"E":e>=112.5&&e<157.5?"SE":e>=157.5&&e<202.5?"S":e>=202.5&&e<247.5?"SW":e>=247.5&&e<292.5?"W":e>=292.5&&e<337.5?"NW":"error"}t(1),t(2),t(0);var d=void 0,l=void 0,u=[],h=[],p=0,g=31.771947,m=35.204153,v=[{name:"Jaffa Gate / Old City",id:"oldcity",lat:31.776598,long:35.227609,src:"./assets/bells.wav"},{name:"The Knesset",id:"knesset",lat:31.77663,long:35.205471,src:"./assets/drums.wav"},{name:"Mahane Yehuda Market",id:"market",lat:31.784851,long:35.212643,src:"./assets/market.wav"},{name:"Yad Vashem / Mt. Herzl",id:"herzl",lat:31.774192,long:35.176195,src:"./assets/violin.wav"},{name:"Teddy Stadium",id:"teddy",lat:31.750973,long:35.190621,src:"./assets/crowd.wav"},{name:"Ammunition Hill",id:"hill",lat:31.798014,long:35.227671,src:"./assets/trumpet.wav"},{name:"The Israel Museum",id:"museum",lat:31.771947,long:35.204153,src:"./assets/piano.wav"},,{name:"Mount Scopus",id:"scopus",lat:31.795354,long:35.242609,src:"./assets/guitar.wav"}],f=0,_=["museum","scopus","herzl"],w=[["knesset","herzl","market"],["oldcity","teddy","hill"],["scopus","museum","teddy"]],b=[["oldcity","teddy","museum"],["knesset","herzl","scopus"],["herzl","teddy","oldcity"]],k=void 0,y=void 0,E=!1,L=!1,M=.02,S=1,H=function(){o(),r(),Compass.watch(function(e){document.getElementById("heading").innerHTML=s(e),i(e)}),document.getElementById("play").addEventListener("click",function(e){d.resume(),L?E?(u.forEach(function(e){e.pause()}),E=!1,e.target.innerHTML="Play All"):(u.forEach(function(e){e.play()}),E=!0,e.target.innerHTML="Pause All"):(e.target.innerHTML="Play All",document.getElementById("hints").classList.remove("hidden"),document.getElementById("options").classList.remove("hidden"),L=!0),document.getElementById("play").addEventListener("touchstart",function(e){e.target.classList.add("active")}),document.getElementById("play").addEventListener("touchend",function(e){e.target.classList.remove("active")})})};window.addEventListener("load",H);var P={width:2,height:2,depth:2},I={brick:{left:"brick-bare",right:"brick-bare",up:"brick-bare",down:"wood-panel",front:"brick-bare",back:"brick-bare"},curtains:{left:"curtain-heavy",right:"curtain-heavy",up:"wood-panel",down:"wood-panel",front:"curtain-heavy",back:"curtain-heavy"},marble:{left:"marble",right:"marble",up:"marble",down:"marble",front:"marble",back:"marble"},outside:{left:"transparent",right:"transparent",up:"transparent",down:"grass",front:"transparent",back:"transparent"}}}]);